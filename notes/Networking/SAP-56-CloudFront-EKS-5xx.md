---
id: "SAP-56"
title: "CloudFront 5xx Troubleshooting"
category: "Networking"
domain: "Continuous Improvement"
tags:
  - "CloudFront"
  - "EKS"
  - "ALB"
  - "Troubleshooting"
  - "502/504"
created_at: "2026-02-05"
---

# CloudFront 5xx Troubleshooting (SAP-56)

## 1. çŠ¶æ³ã®èª­ã¿è§£ã (Context & Requirements)

- **æ§‹æˆå›³ã®åˆ†æž**: CloudFront -> ALB -> EKS (Microservices)ã€‚
- **å¿…é ˆè¦ä»¶**:
    - **502/504 ã‚¨ãƒ©ãƒ¼ã®æ€¥å¢—**: ã‚¢ã‚¯ã‚»ã‚¹å¢—åŠ ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ç™ºç”Ÿã€‚
    - **é‹ç”¨è² è·ã®è€ƒæ…®**: å°è¦æ¨¡ãƒãƒ¼ãƒ ã§ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªå¯¾å¿œãŒå¿…è¦ã€‚

## 2. å‹è² ã‚’æ±ºã‚ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ (Trigger Words)

- **"504" (Gateway Timeout)**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€‚å‡¦ç†é…å»¶ãŒæœ€å¤§ã®åŽŸå› ã€‚
- **"502" (Bad Gateway)**: ä¸æ­£ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã€‚ã‚µãƒ¼ãƒãƒ¼ãƒ€ã‚¦ãƒ³ã€ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³åˆ‡æ–­ãªã©ã€‚
- **"WAF"**: WAFã®ãƒ–ãƒ­ãƒƒã‚¯ã¯é€šå¸¸ **403 Forbidden** ã§ã‚ã‚Šã€5xx ã§ã¯ãªã„ã€‚

## 3. ãªãœãã®ç­”ãˆã‹ (Reasoning)

- **è«–ç†çš„æ ¹æ‹  (A & E)**:
    - **E (504ã®åŽŸå› )**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (EKS Pod) ã®å‡¦ç†è² è·ãŒé«˜ã¾ã‚Šã€å¿œç­”ãŒé…å»¶ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã€‚CloudFront ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆã¾ãŸã¯è¨­å®šå€¤ï¼‰ã‚’è¶…ãˆã‚‹ã¨ 504 ãŒè¿”ã‚‹ã€‚
    - **A (502ã®åŽŸå› )**: Pod ãŒé«˜è² è·ã§ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ (CrashLoopBackOff) ã™ã‚‹ã¨ã€ALB ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã«å¤±æ•—ã—ã€æœ‰åŠ¹ãªã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒã„ãªããªã‚‹ã€‚ALB ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã§ããšæŽ¥ç¶šã‚’åˆ‡æ–­ã¾ãŸã¯ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã¨ã€CloudFront ã¯ 502 ã‚’è¿”ã™ã€‚
- **é¸æŠžè‚¢ã®åˆ†æž**:
    - **B (èª¤ã£ãŸALB)**: è¨­å®šãƒŸã‚¹ãªã‚‰ã€Œã‚¢ã‚¯ã‚»ã‚¹å¢—åŠ ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€ã«é–¢ä¿‚ãªãå¸¸ã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã¯ãšã€‚
    - **C (SSL/TLS)**: ã“ã‚Œã‚‚è¨­å®šãƒŸã‚¹ï¼ˆé™çš„è¦å› ï¼‰ã§ã‚ã‚Šã€è² è·å¢—åŠ ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æ€¥å¢—ã™ã‚‹ã‚‚ã®ã§ã¯ãªã„ï¼ˆé€šå¸¸ã¯ 502ï¼‰ã€‚
    - **D (WAF)**: WAF ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯ **403** ãªã®ã§ã€502/504 ã®åŽŸå› ã¨ã—ã¦ã¯ä¸é©åˆ‡ã€‚

## 4. æ¯”è¼ƒã¨å…¬å¼è³‡æ–™ (Comparison)

- **æ¯”è¼ƒè¡¨**:

| Error Code | Meaning | Common Cause (Backend) |
| :--- | :--- | :--- |
| **504** | Gateway Timeout | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†é…å»¶ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é…å»¶ |
| **502** | Bad Gateway | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ€ã‚¦ãƒ³ã€TCPãƒªã‚»ãƒƒãƒˆã€ãƒ˜ãƒƒãƒ€ãƒ¼ä¸æ­£ |
| **503** | Service Unavailable | ã‚¿ãƒ¼ã‚²ãƒƒãƒˆä¸è¶³ã€ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ä¸è¶³ (Throttling) |
| **403** | Forbidden | WAF ãƒ–ãƒ­ãƒƒã‚¯ã€S3 æ¨©é™ä¸è¶³ã€Geo Restriction |

- **è©³ç´°è³‡æ–™**: [CloudFront ã‹ã‚‰ã® HTTP 502/504 ã‚¨ãƒ©ãƒ¼ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](https://repost.aws/ja/knowledge-center/cloudfront-troubleshoot-502-504)

## 5. å­¦ç¿’ãƒ¡ãƒ¢ (Exam Note)

â–  AWS SAP Exam Note: CloudFront 5xx Troubleshooting (SAP-56)

> ### ðŸ“Œ Core Concept
> CloudFrontå¾Œæ–¹ã®ã‚¨ãƒ©ãƒ¼è§£æ±ºã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã§åˆ‡ã‚Šåˆ†ã‘ã‚‹ã€‚
> - 504 = æ™‚é–“åˆ‡ã‚Œï¼ˆã‚ªãƒªã‚¸ãƒ³ãŒé…ã„ / ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ–­ï¼‰
> - 502 = ç–Žé€šãƒ»èªè¨¼å¤±æ•—ï¼ˆè¨¼æ˜Žæ›¸ / ãƒ—ãƒ­ãƒˆã‚³ãƒ« / æŽ¥ç¶šæ‹’å¦ / ã‚¢ãƒ—ãƒªãƒ€ã‚¦ãƒ³ï¼‰

> ### ðŸ›  Trigger âž” Best Practice
> | æ³¨ç›®äº‹è±¡ (Trigger) | èª¿æŸ»ã™ã¹ãå¯¾è±¡ (Best Practice) |
> | :--- | :--- |
> | è² è·å¢—ã«ä¼´ã† 504 | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰(EKS/EC2)ã®å‡¦ç†æ™‚é–“ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå€¤ã®ä¸æ•´åˆ |
> | Podã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹ 502 | ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã€ãƒªã‚½ãƒ¼ã‚¹ä¸è¶³ (OOMKilledç­‰) |
> | å¤§é‡ã® 403 ã‚¨ãƒ©ãƒ¼ | WAFã®ãƒ«ãƒ¼ãƒ«ã€ã‚ªãƒªã‚¸ãƒ³ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ (OAC/OAI) |

> ### âš ï¸ Pitfall / Anti-Pattern
> - WAF = 5xx ã¨å‹˜é•ã„ã—ãªã„ã“ã¨ã€‚WAFã¯åŽŸå‰‡ 403ã€‚
> - 504ãŒç™ºç”Ÿã—ãŸéš›ã€CloudFrontã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã‚’ä¼¸ã°ã™ã®ã¯ã€Œå¯¾ç—‡ç™‚æ³•ã€ã€‚æœ¬è³ªã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆEKSã®HPAç­‰ï¼‰ã‚„é«˜é€ŸåŒ–ã€‚

> ### ðŸ’¡ Exam Shortcut
> 504 = "Wait too long" (Timeout)
> 502 = "Bad Connection" (Crash/SSL)
