---
id: "SAP-56"
title: "CloudFront 5xx Troubleshooting"
related_note: "../../notes/Networking/SAP-56-CloudFront-EKS-5xx.md"
---

# Problem Statement

【SAP-56】 デジタル家電や衣料品を扱うあるeコマース企業は、AWS上のマイクロサービス基盤で商品検索・購入APIをWeb/モバイル向けに公開し、秒以下の応答を目指している。
同社はAmazon EKS上の数千ポッド群をALBで前段集約し、リージョン拡大に伴うレイテンシ低減と不正アクセス対策を目的に、CloudFrontをオリジンALB、WAF付きで追加した。
CloudFrontの導入後、新しいリージョンからのアクセス増加によりAPIコールが大幅に増加し、そのタイミングで特定ドメインに対するHTTP 502および504が急増し、API呼び出し失敗が顕在化している。
小規模な運用チームでスケーラブルに運営することが前提である。
ビジネスへの影響を最小化するため、ソリューションアーキテクトは原因としてどの要因を想定して調査を開始すべきか。最も可能性の高いものを2つ選べ。

# Options

A. EKS クラスタ内で一部ポッドが CrashLoopBackOff 状態になっており、ALB のターゲットとしてヘルスチェックに失敗した結果、CloudFront から 5xx が返されている。
B. CloudFront のオリジンとして誤った ALB を指定しており、本来の EKS バックエンドとは異なる ALB （あるいは設定不備の ALB） にルーティングされている結果、オリジン側で 5xx が多発している。
C. CloudFront とオリジン ALB 間の SSL/TLS ハンドシェイクに問題があり、証明書設定やサポートプロトコルの不整合によって一部ドメインやパスへの接続が確立できず、結果として 5xx が発生している。
D. AWS WAF のルール設定により疑わしいリクエストがブロックされているが、シグネチャマッチの範囲が広すぎて正規の API 呼び出しも対象となり、利用者からは大量のエラーとして認識されている。
E. EKS 上の一部ポッドでバックエンド API のレスポンスが 30 秒近くまで遅延し、CloudFront からのタイムアウト（502/504）が発生している。

# Answer
A, E
